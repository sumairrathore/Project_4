<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="The dashboard will allow users to explore and analyze the data based on different filters, enabling them to gain insights and make data-driven decisions.">
        <meta name="keywords" content="Fifa, Analytics, Dashboard">
        <meta name="author" content="xlivia">
        <meta name="robots" content="index, follow">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>UofT Data Analytics Bootcamp Project 4</title>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    </head>
    <body>
        <header>
            <h1>Fifa Analytics Dashboard</h1>
        </header>
        <nav class="top-nav">
            <ul>
                <li><a href="/">All Data</a></li>
                <li><a href="/player">Player Data</a></li>
                <li><a href="/league">League Data</a></li>
                <li><a href="/map">Map</a></li>
            </ul>
        </nav>
        <section>
            <div class="filters">
                <ul class="list-unstyled">
                    <li><a href="#players_17">Players 2017</a></li>
                    <li><a href="#players_18">Players 2018</a></li>
                    <li><a href="#players_19">Players 2019</a></li>
                    <li><a href="#players_20">Players 2020</a></li>
                    <li><a href="#players_21">Players 2021</a></li>
                    <li><a href="#players_22">Players 2022</a></li>
                    <li><a href="#players_23">Players 2023</a></li>
                </ul>
            </div>
            <div class="content col-lg-9">
                <h2>Player Data</h2>
                <div class="search-container">
                    <input type="text" id="search-bar" placeholder="Search for a player...">
                    <button onclick="searchPlayer()">Search</button>
                </div>
                <select id="player-select" onchange="getPlayerInfo()">
                    <option value="">Select a player</option>
                    {% for player in players %}
                    <option value="{{ player }}">{{ player }}</option>
                    {% endfor %}
                </select>
                <table id="player-table" class="table table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Nationality</th>
                            <th>Club</th>
                            <th>Overall</th>
                            <th>Potential</th>
                            <th>Wage</th>
                            <th>Club Logo</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
        <footer>
            <p>Project 4</p>
        </footer>
        <script src="{{ url_for('static', filename='js/player.js') }}"></script>
        <script>
            function getPlayerInfo() {
    // Get the selected player from the dropdown
    const selectedPlayer = document.getElementById("player-select").value;

    // Clear the player table body before populating new data
    const playerTableBody = document.getElementById("player-table").getElementsByTagName("tbody")[0];
    playerTableBody.innerHTML = "";

    // Make an AJAX request to fetch player information based on the selected player
    fetch(`/player_info?selectedPlayer=${selectedPlayer}`)
        .then(response => response.json())
        .then(data => {
            // Populate the player table with the retrieved data
            if (data.length > 0) {
                data.forEach(playerInfo => {
                    const row = document.createElement("tr");
                    const nameCell = document.createElement("td");
                    nameCell.textContent = playerInfo.Name;
                    const ageCell = document.createElement("td");
                    ageCell.textContent = playerInfo.Age;
                    const nationalityCell = document.createElement("td");
                    nationalityCell.textContent = playerInfo.Nationality;
                    const clubCell = document.createElement("td");
                    clubCell.textContent = playerInfo.Club;
                    const overallCell = document.createElement("td");
                    overallCell.textContent = playerInfo.Overall;
                    const potentialCell = document.createElement("td");
                    potentialCell.textContent = playerInfo.Potential;
                    const wageCell = document.createElement("td"); // New cell for Wage
                    wageCell.textContent = playerInfo.Wage;
                    const clubLogoCell = document.createElement("td"); // New cell for Club Logo
                    clubLogoCell.innerHTML = `<img src="${playerInfo["Club Logo"]}" alt="${playerInfo.Club} Logo" height="40" width="40">`;
                    // Use square brackets to access the "Club Logo" property in the playerInfo object
                    // This is because the property name contains a space, so we need to use the correct key name.

                    row.appendChild(nameCell);
                    row.appendChild(ageCell);
                    row.appendChild(nationalityCell);
                    row.appendChild(clubCell);
                    row.appendChild(overallCell);
                    row.appendChild(potentialCell);
                    row.appendChild(wageCell); // Add the Wage cell to the row
                    row.appendChild(clubLogoCell); // Add the Club Logo cell to the row

                    playerTableBody.appendChild(row);
                });
            } else {
                // If no data is found, display a message in the table
                const row = document.createElement("tr");
                const messageCell = document.createElement("td");
                messageCell.colSpan = 8; // Adjust the colspan according to the number of columns in the table
                messageCell.textContent = "No data available for the selected player.";
                row.appendChild(messageCell);
                playerTableBody.appendChild(row);
            }
        })
        .catch(error => {
            console.error("Error fetching player information:", error);
        });
}

            function searchPlayer() {
                const searchText = document.getElementById("search-bar").value;
                const playerSelect = document.getElementById("player-select");
        
                // Search for the player in the dropdown options
                const options = playerSelect.getElementsByTagName("option");
                for (let i = 0; i < options.length; i++) {
                    const player = options[i].value;
                    if (player.toLowerCase().includes(searchText.toLowerCase())) {
                        // If the player is found, set it as the selected option and trigger getPlayerInfo()
                        playerSelect.value = player;
                        getPlayerInfo();
                        break;
                    }
                }
            }
        </script>
    </body>
    </html>